<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ì‘ì—…ê¸°ë¡">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.json">
  <title>ì‘ì—…ê¸°ë¡</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', sans-serif;
      background: #f2f2f7;
      color: #1c1c1e;
      padding-bottom: 90px;
      -webkit-user-select: none;
      user-select: none;
    }
    .header {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white;
      padding: 24px 20px 20px;
      text-align: center;
    }
    .header h1 { font-size: 20px; font-weight: 700; }
    .header p { font-size: 13px; opacity: 0.6; margin-top: 4px; }
    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      padding: 16px;
    }
    .stat-card {
      background: white;
      border-radius: 14px;
      padding: 14px 8px;
      text-align: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    }
    .stat-card .number { font-size: 26px; font-weight: 700; color: #1a1a2e; }
    .stat-card .label { font-size: 11px; color: #8e8e93; margin-top: 2px; }
    .section-title {
      padding: 20px 16px 8px;
      font-size: 13px;
      font-weight: 600;
      color: #8e8e93;
      text-transform: uppercase;
    }
    .card-list { padding: 0 16px; }
    .card {
      background: white;
      border-radius: 14px;
      padding: 14px 16px;
      margin-bottom: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.15s;
    }
    .card:active { transform: scale(0.98); }
    .card .info h3 { font-size: 15px; font-weight: 600; }
    .card .info p { font-size: 12px; color: #8e8e93; margin-top: 2px; }
    .badge {
      font-size: 13px;
      font-weight: 600;
      padding: 5px 12px;
      border-radius: 20px;
      white-space: nowrap;
    }
    .badge-green { color: #34c759; background: #eafbef; }
    .badge-blue { color: #007aff; background: #e8f0fe; }
    .badge-orange { color: #ff9500; background: #fff4e6; }

    /* ê¸°ë¡ ì¶”ê°€ ëª¨ë‹¬ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      z-index: 100;
      align-items: flex-end;
      justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: #f2f2f7;
      width: 100%;
      max-height: 85vh;
      border-radius: 14px 14px 0 0;
      padding: 20px;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }
    .modal h2 { font-size: 18px; font-weight: 700; margin-bottom: 16px; text-align: center; }
    .modal label { font-size: 13px; color: #8e8e93; display: block; margin: 12px 0 6px; }
    .modal input, .modal select {
      width: 100%;
      padding: 12px 14px;
      border: none;
      border-radius: 10px;
      background: white;
      font-size: 16px;
      font-family: inherit;
      -webkit-appearance: none;
    }
    .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
    .modal-buttons button {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
    }
    .btn-cancel { background: #e5e5ea; color: #1c1c1e; }
    .btn-save { background: #1a1a2e; color: white; }

    .fab {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 26px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.25);
      cursor: pointer;
      z-index: 50;
      transition: transform 0.15s;
    }
    .fab:active { transform: scale(0.92); }
    .nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: flex;
      justify-content: space-around;
      padding: 8px 0 20px;
      border-top: 0.5px solid #d1d1d6;
      z-index: 50;
    }
    .nav-item {
      text-align: center;
      font-size: 10px;
      color: #8e8e93;
      cursor: pointer;
      transition: color 0.15s;
      background: none;
      border: none;
      font-family: inherit;
    }
    .nav-item.active { color: #007aff; }
    .nav-item .icon { font-size: 24px; display: block; margin-bottom: 2px; }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #8e8e93;
    }
    .empty-state .emoji { font-size: 48px; margin-bottom: 12px; }
    .empty-state p { font-size: 14px; }
  </style>
</head>
<body>
  <div class="header">
    <h1 id="headerTitle">ì‘ì—…ê¸°ë¡</h1>
    <p id="headerDate"></p>
  </div>

  <div id="page-home">
    <div class="stats">
      <div class="stat-card">
        <div class="number" id="statTotal">0</div>
        <div class="label">ì´ë²ˆ ë‹¬ ì‘ì—…</div>
      </div>
      <div class="stat-card">
        <div class="number" id="statAvg">-</div>
        <div class="label">í‰ê· (ë¶„)</div>
      </div>
      <div class="stat-card">
        <div class="number" id="statCount">0</div>
        <div class="label">ì˜¤ëŠ˜ ì‘ì—…</div>
      </div>
    </div>

    <div class="section-title">ìµœê·¼ ê¸°ë¡</div>
    <div class="card-list" id="recentList"></div>
  </div>

  <div id="page-list" style="display:none">
    <div class="section-title">ì „ì²´ ê¸°ë¡</div>
    <div class="card-list" id="allList"></div>
  </div>

  <div id="page-stats" style="display:none">
    <div class="stats">
      <div class="stat-card">
        <div class="number" id="sTotal">0</div>
        <div class="label">ì´ ì‘ì—… ìˆ˜</div>
      </div>
      <div class="stat-card">
        <div class="number" id="sAvg">-</div>
        <div class="label">í‰ê·  ì‹œê°„</div>
      </div>
      <div class="stat-card">
        <div class="number" id="sBest">-</div>
        <div class="label">ìµœë‹¨ ê¸°ë¡</div>
      </div>
    </div>
    <div class="section-title">ì‘ì—… ìœ í˜•ë³„</div>
    <div class="card-list" id="statsByType"></div>
  </div>

  <button class="fab" onclick="openModal()">+</button>

  <div class="modal-overlay" id="modal">
    <div class="modal">
      <h2>ì‘ì—… ê¸°ë¡ ì¶”ê°€</h2>
      <label>ì°¨ì¢…</label>
      <input type="text" id="inputCar" placeholder="ì˜ˆ: ì†Œë‚˜íƒ€ DN8">
      <label>ì‘ì—… ìœ í˜•</label>
      <select id="inputType">
        <option>ì™¸ë¶€ì„¸ì°¨</option>
        <option>ë‚´ë¶€ì„¸ì°¨</option>
        <option>ê´‘íƒ 1ë‹¨ê³„</option>
        <option>ê´‘íƒ 2ë‹¨ê³„</option>
        <option>í’€ì½”ìŠ¤</option>
      </select>
      <label>ì†Œìš” ì‹œê°„ (ë¶„)</label>
      <input type="number" id="inputTime" placeholder="ì˜ˆ: 40">
      <div class="modal-buttons">
        <button class="btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
        <button class="btn-save" onclick="saveRecord()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <nav class="nav">
    <button class="nav-item active" onclick="showPage('home', this)">
      <span class="icon">ğŸ </span>í™ˆ
    </button>
    <button class="nav-item" onclick="showPage('list', this)">
      <span class="icon">ğŸ“‹</span>ê¸°ë¡
    </button>
    <button class="nav-item" onclick="showPage('stats', this)">
      <span class="icon">ğŸ“Š</span>í†µê³„
    </button>
  </nav>

  <script>
    // ë‚ ì§œ í‘œì‹œ
    const now = new Date();
    const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
    document.getElementById('headerDate').textContent =
      `${now.getFullYear()}ë…„ ${now.getMonth()+1}ì›” ${now.getDate()}ì¼ ${days[now.getDay()]}ìš”ì¼`;

    // ë°ì´í„° ê´€ë¦¬
    function getRecords() {
      return JSON.parse(localStorage.getItem('records') || '[]');
    }
    function saveRecords(records) {
      localStorage.setItem('records', JSON.stringify(records));
    }

    // í™”ë©´ ì „í™˜
    function showPage(page, el) {
      document.querySelectorAll('[id^="page-"]').forEach(p => p.style.display = 'none');
      document.getElementById('page-' + page).style.display = 'block';
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      el.classList.add('active');
      render();
    }

    // ëª¨ë‹¬
    function openModal() {
      document.getElementById('modal').classList.add('active');
    }
    function closeModal() {
      document.getElementById('modal').classList.remove('active');
      document.getElementById('inputCar').value = '';
      document.getElementById('inputTime').value = '';
    }

    // ì €ì¥
    function saveRecord() {
      const car = document.getElementById('inputCar').value.trim();
      const type = document.getElementById('inputType').value;
      const time = parseInt(document.getElementById('inputTime').value);
      if (!car || !time) return alert('ì°¨ì¢…ê³¼ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
      const records = getRecords();
      records.unshift({
        car, type, time,
        date: new Date().toISOString(),
        id: Date.now()
      });
      saveRecords(records);
      closeModal();
      render();
    }

    // ì‚­ì œ
    function deleteRecord(id) {
      if (!confirm('ì‚­ì œí• ê¹Œìš”?')) return;
      const records = getRecords().filter(r => r.id !== id);
      saveRecords(records);
      render();
    }

    // ì¹´ë“œ ë§Œë“¤ê¸°
    function makeCard(r) {
      const d = new Date(r.date);
      const dateStr = `${d.getMonth()+1}/${d.getDate()}`;
      const badgeClass = r.type.includes('ê´‘íƒ') ? 'badge-blue' :
                         r.type.includes('í’€ì½”ìŠ¤') ? 'badge-orange' : 'badge-green';
      return `<div class="card" onclick="deleteRecord(${r.id})">
        <div class="info">
          <h3>${r.car}</h3>
          <p>${r.type} Â· ${dateStr}</p>
        </div>
        <span class="badge ${badgeClass}">${r.time}ë¶„</span>
      </div>`;
    }

    // ë Œë”ë§
    function render() {
      const records = getRecords();
      const today = new Date().toDateString();
      const todayRecords = records.filter(r => new Date(r.date).toDateString() === today);
      const thisMonth = records.filter(r => {
        const d = new Date(r.date);
        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
      });

      // í™ˆ
      document.getElementById('statTotal').textContent = thisMonth.length;
      document.getElementById('statCount').textContent = todayRecords.length;
      if (thisMonth.length > 0) {
        const avg = Math.round(thisMonth.reduce((s,r) => s + r.time, 0) / thisMonth.length);
        document.getElementById('statAvg').textContent = avg;
      }
      const recent = records.slice(0, 5);
      document.getElementById('recentList').innerHTML = recent.length
        ? recent.map(makeCard).join('')
        : '<div class="empty-state"><div class="emoji">ğŸš—</div><p>+ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ì‘ì—…ì„ ê¸°ë¡í•˜ì„¸ìš”</p></div>';

      // ì „ì²´ ê¸°ë¡
      document.getElementById('allList').innerHTML = records.length
        ? records.map(makeCard).join('')
        : '<div class="empty-state"><div class="emoji">ğŸ“‹</div><p>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';

      // í†µê³„
      document.getElementById('sTotal').textContent = records.length;
      if (records.length > 0) {
        const avg = Math.round(records.reduce((s,r) => s + r.time, 0) / records.length);
        const best = Math.min(...records.map(r => r.time));
        document.getElementById('sAvg').textContent = avg + 'ë¶„';
        document.getElementById('sBest').textContent = best + 'ë¶„';

        const types = {};
        records.forEach(r => { types[r.type] = (types[r.type] || 0) + 1; });
        document.getElementById('statsByType').innerHTML = Object.entries(types)
          .sort((a,b) => b[1] - a[1])
          .map(([type, count]) => `<div class="card">
            <div class="info"><h3>${type}</h3><p>${count}ê±´</p></div>
            <span class="badge badge-blue">${Math.round(count/records.length*100)}%</span>
          </div>`).join('');
      }
    }

    render();
  </script>
</body>
</html>